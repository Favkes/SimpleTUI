name: Render Mermaid Diagrams

on:
  push:
    branches:
      - '**'
  pull_request:

permissions:
  contents: write   # ‚Üê REQUIRED for generated files

jobs:
  render-diagrams:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Render .mmd diagrams to svg
        run: |
          mkdir -p docs/assets/diagrams
          for f in diagrams/*.mmd; do
            out="docs/assets/diagrams/$(basename "$f" .mmd).svg"
            docker run --rm -v "${PWD}":/work ghcr.io/mermaid-js/mermaid-cli:latest \
              -i "/work/$f" -o "/work/$out"
          done
