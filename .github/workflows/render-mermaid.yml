name: Render Mermaid Diagrams

on:
  push:
    branches:
      - '**'
  pull_request:

permissions:
  contents: write   # ← REQUIRED for generated files

jobs:
  render-diagrams:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Mermaid CLI
        run: npm install -g @mermaid-js/mermaid-cli

      - name: Render .mmd → .svg
        run: |
          mkdir -p docs/assets/diagrams
          for f in diagrams/*.mmd; do
            out="docs/assets/diagrams/$(basename "$f" .mmd).svg"
            echo "Rendering $f → $out"
            mmdc -i "$f" -o "$out"
          done
